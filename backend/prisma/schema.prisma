generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  MODERATOR
  GENEL_BASKAN
  GENEL_BASKAN_YRD
  GENEL_SEKRETER
  IL_BASKANI
  ILCE_TEMSILCISI
  ISYERI_TEMSILCISI
  BAYI_YETKILISI
  UYE
}

model User {
  id           String @id @default(cuid())
  email        String @unique
  passwordHash String
  firstName    String
  lastName     String

  roles Role[] // Postgres enum[] olarak tutulacak

  isActive  Boolean   @default(true)
  deletedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  scopes UserScope[]
}

enum MemberStatus {
  PENDING // baÅŸvuru yapÄ±ldÄ±, onay bekliyor
  ACTIVE // aktif Ã¼ye
  PASIF // pasif
  ISTIFA // istifa etmiÅŸ
  IHRAC // ihraÃ§ edilmiÅŸ
  REJECTED // baÅŸvuru reddedildi
}

enum MemberSource {
  DIRECT // panelden direkt baÅŸvuru
  WORKPLACE // iÅŸyeri temsilcisi Ã¼zerinden
  DEALER // bayi Ã¼zerinden
  OTHER
}

enum DuesPeriod {
  MONTHLY
  YEARLY
}

model Member {
  id         String       @id @default(cuid())
  firstName  String
  lastName   String
  nationalId String?      @unique
  phone      String?
  email      String?
  status     MemberStatus @default(PENDING)
  source     MemberSource @default(DIRECT)

  // BÃ¶lge iliÅŸkileri vs...
  provinceId  String?
  districtId  String?
  workplaceId String?
  dealerId    String?

  province  Province?  @relation(fields: [provinceId], references: [id])
  district  District?  @relation(fields: [districtId], references: [id])
  workplace Workplace? @relation(fields: [workplaceId], references: [id])
  dealer    Dealer?    @relation(fields: [dealerId], references: [id])

  createdByUserId  String?
  approvedByUserId String?
  approvedAt       DateTime?

  // ðŸ”¹ Aidat planÄ± iliÅŸkisi
  duesPlanId String?
  duesPlan   DuesPlan? @relation(fields: [duesPlanId], references: [id])

  // Aidat Ã¶demeleri
  duesPayments DuesPayment[]

  isActive  Boolean   @default(true)
  deletedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Province {
  id   String  @id @default(cuid())
  name String
  code String? @unique

  districts  District[]
  workplaces Workplace[]
  dealers    Dealer[]
  members    Member[]

  userScopes UserScope[]
}

model District {
  id         String   @id @default(cuid())
  name       String
  provinceId String
  province   Province @relation(fields: [provinceId], references: [id])

  workplaces Workplace[]
  dealers    Dealer[]
  members    Member[]

  userScopes UserScope[]
}

model Workplace {
  id      String  @id @default(cuid())
  name    String
  address String?

  provinceId String?
  districtId String?

  province Province? @relation(fields: [provinceId], references: [id])
  district District? @relation(fields: [districtId], references: [id])

  members Member[]

  userScopes UserScope[]
}

model Dealer {
  id      String  @id @default(cuid())
  name    String
  code    String?
  address String?

  provinceId String?
  districtId String?

  province Province? @relation(fields: [provinceId], references: [id])
  district District? @relation(fields: [districtId], references: [id])

  members Member[]

  userScopes UserScope[]
}

model UserScope {
  id     String @id @default(cuid())
  userId String
  user   User   @relation(fields: [userId], references: [id])

  provinceId  String?
  districtId  String?
  workplaceId String?
  dealerId    String?

  province  Province?  @relation(fields: [provinceId], references: [id])
  district  District?  @relation(fields: [districtId], references: [id])
  workplace Workplace? @relation(fields: [workplaceId], references: [id])
  dealer    Dealer?    @relation(fields: [dealerId], references: [id])

  createdAt DateTime @default(now())
}

model DuesPlan {
  id          String     @id @default(cuid())
  name        String
  description String?
  amount      Decimal    @db.Decimal(10, 2)
  period      DuesPeriod @default(MONTHLY)
  isActive    Boolean    @default(true)
  deletedAt   DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  payments DuesPayment[]

  members Member[]
}

model DuesPayment {
  id String @id @default(cuid())

  memberId String
  member   Member @relation(fields: [memberId], references: [id])

  planId String?
  plan   DuesPlan? @relation(fields: [planId], references: [id])

  amount Decimal
  paidAt DateTime @default(now())

  // Ä°steÄŸe baÄŸlÄ±: hangi ay/yÄ±l iÃ§in
  periodYear  Int?
  periodMonth Int?

  note            String?
  createdByUserId String?

  isActive  Boolean   @default(true)
  deletedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
