generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  MODERATOR
  GENEL_BASKAN
  GENEL_BASKAN_YRD
  GENEL_SEKRETER
  IL_BASKANI
  ILCE_TEMSILCISI
  UYE
}

model User {
  id           String @id @default(cuid())
  email        String @unique
  passwordHash String
  firstName    String
  lastName     String

  isActive  Boolean   @default(true)
  deletedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  scopes      UserScope[]
  customRoles CustomRole[] @relation("UserCustomRoles")

  // ðŸ”¹ Ãœye iliÅŸkileri
  createdMembers   Member[] @relation("MemberCreatedBy")
  approvedMembers  Member[] @relation("MemberApprovedBy")
  cancelledMembers Member[] @relation("MemberCancelledBy")

  // ðŸ”¹ Ä°Ã§erik iliÅŸkileri
  authoredContents Content[] @relation("ContentAuthor")

  // ðŸ”¹ DokÃ¼man iliÅŸkileri
  generatedDocuments MemberDocument[] @relation("DocumentGeneratedBy")

  // ðŸ”¹ Bildirim iliÅŸkileri
  sentNotifications Notification[] @relation("NotificationSentBy")

  // ðŸ”¹ Sistem ayarlarÄ± iliÅŸkileri
  updatedSystemSettings SystemSetting[] @relation("SystemSettingUpdatedBy")

  // ðŸ”¹ Sistem loglarÄ± iliÅŸkileri
  systemLogs SystemLog[] @relation("SystemLogUser")

  // ðŸ”¹ Åžube iliÅŸkileri
  branches Branch[] @relation("BranchPresident")

  // ðŸ”¹ Ãœye geÃ§miÅŸi iliÅŸkileri
  memberHistory MemberHistory[] @relation("MemberHistoryUser")

  // ðŸ”¹ Onay iliÅŸkileri
  requestedApprovals Approval[] @relation("ApprovalRequestedBy")
  approvedApprovals  Approval[] @relation("ApprovalApprovedBy")
  rejectedApprovals  Approval[] @relation("ApprovalRejectedBy")

  // ðŸ”¹ Tevkifat dosya iliÅŸkileri
  uploadedTevkifatFiles TevkifatFile[] @relation("TevkifatFileUploadedBy")
  approvedTevkifatFiles TevkifatFile[] @relation("TevkifatFileApprovedBy")

  // ðŸ”¹ Ãœye Ã¶deme iliÅŸkileri
  createdMemberPayments  MemberPayment[] @relation("MemberPaymentCreatedBy")
  approvedMemberPayments MemberPayment[] @relation("MemberPaymentApprovedBy")

  // ðŸ”¹ KullanÄ±cÄ± bildirimleri
  userNotifications    UserNotification[]        @relation("UserNotifications")
  notificationSettings UserNotificationSettings? @relation("UserNotificationSettings")
}

enum MemberStatus {
  PENDING // baÅŸvuru yapÄ±ldÄ±, onay bekliyor
  ACTIVE // aktif Ã¼ye
  INACTIVE // pasif
  RESIGNED // istifa etmiÅŸ
  EXPELLED // ihraÃ§ edilmiÅŸ
  REJECTED // baÅŸvuru reddedildi
}

enum MemberSource {
  DIRECT // panelden direkt baÅŸvuru
  OTHER
}

enum Gender {
  MALE
  FEMALE
  OTHER
}

enum EducationStatus {
  PRIMARY
  HIGH_SCHOOL
  COLLEGE
}

enum PositionTitle {
  KADRO_657
  SOZLESMELI_4B
  KADRO_663
  AILE_HEKIMLIGI
  UNVAN_4924
  DIGER_SAGLIK_PERSONELI
}

model Member {
  id         String       @id @default(cuid())
  firstName  String
  lastName   String
  nationalId String       @unique // TC (zorunlu)
  phone      String?
  email      String?
  status     MemberStatus @default(PENDING)
  source     MemberSource @default(DIRECT)

  // ðŸ”¹ Ãœyelik & YÃ¶netim Kurulu Bilgileri
  membershipInfoOptionId String? // Admin tarafÄ±ndan yÃ¶netilen seÃ§meli bilgi
  membershipInfoOption   MembershipInfoOption? @relation(fields: [membershipInfoOptionId], references: [id])
  registrationNumber     String                @unique // Ãœye kayÄ±t numarasÄ± (zorunlu, benzersiz, admin belirler)
  boardDecisionDate      DateTime? // YÃ¶netim kurulu karar tarihi
  boardDecisionBookNo    String? // YÃ¶netim kurulu karar defter no

  // ðŸ”¹ Kimlik & KiÅŸisel Bilgiler
  motherName String? // Anne adÄ± (seÃ§meli)
  fatherName String? // Baba adÄ± (seÃ§meli)
  birthDate  DateTime? // DoÄŸum tarihi (seÃ§meli)
  birthplace String? // DoÄŸum yeri (seÃ§meli)
  gender     Gender? // Cinsiyet (seÃ§meli)

  // ðŸ”¹ EÄŸitim & Ä°letiÅŸim Bilgileri
  educationStatus EducationStatus? // Ã–ÄŸrenim durumu (seÃ§meli)

  // ðŸ”¹ Kurum Bilgileri
  institutionId    String // Ã‡alÄ±ÅŸtÄ±ÄŸÄ± kurum (zorunlu)
  tevkifatCenterId String? // Tevkifat merkezi (seÃ§meli)
  tevkifatTitleId  String? // Tevkifat Ã¼nvanÄ± (seÃ§meli)
  branchId         String // BaÄŸlÄ± olduÄŸu ÅŸube (zorunlu)

  // BÃ¶lge iliÅŸkileri (ikamet adresi - Ã§alÄ±ÅŸtÄ±ÄŸÄ± yer deÄŸil)
  provinceId String?
  districtId String?

  province Province? @relation("MemberProvince", fields: [provinceId], references: [id])
  district District? @relation("MemberDistrict", fields: [districtId], references: [id])

  // ðŸ”¹ Kurum iliÅŸkileri
  institution    Institution     @relation(fields: [institutionId], references: [id])
  tevkifatCenter TevkifatCenter? @relation(fields: [tevkifatCenterId], references: [id])
  tevkifatTitle  TevkifatTitle?  @relation(fields: [tevkifatTitleId], references: [id])
  branch         Branch          @relation("MemberBranch", fields: [branchId], references: [id])

  // ðŸ”¹ Kurum Detay Bilgileri (Ãœyeye Ã¶zel)
  dutyUnit              String? // GÃ¶rev Birimi
  institutionAddress    String? // Kurum Adresi
  institutionProvinceId String? // Kurum Ä°li
  institutionDistrictId String? // Kurum Ä°lÃ§esi
  professionId          String? // Meslek(Unvan)
  institutionRegNo      String? // Kurum Sicil No
  staffTitleCode        String? // Kadro Unvan Kodu

  // ðŸ”¹ Kurum detay iliÅŸkileri
  institutionProvince Province? @relation("MemberInstitutionProvince", fields: [institutionProvinceId], references: [id])
  institutionDistrict District? @relation("MemberInstitutionDistrict", fields: [institutionDistrictId], references: [id])
  profession          Profession? @relation(fields: [professionId], references: [id])

  createdByUserId  String?
  approvedByUserId String?
  approvedAt       DateTime?

  // ðŸ”¹ KullanÄ±cÄ± iliÅŸkileri
  createdBy  User? @relation("MemberCreatedBy", fields: [createdByUserId], references: [id])
  approvedBy User? @relation("MemberApprovedBy", fields: [approvedByUserId], references: [id])

  // ðŸ”¹ Ãœyelik iptal bilgisi (field Ã¶nce, relation sonra)
  cancelledByUserId  String? // ÃœyeliÄŸi iptal eden kullanÄ±cÄ±
  cancellationReason String? // ÃœyeliÄŸin iptal edilme nedeni
  cancelledAt        DateTime? // ÃœyeliÄŸin iptal edildiÄŸi tarih
  cancelledBy        User?     @relation("MemberCancelledBy", fields: [cancelledByUserId], references: [id])

  // ðŸ”¹ Ã–nceki iptal edilmiÅŸ Ã¼ye bilgisi (yeniden Ã¼ye olanlar iÃ§in)
  previousCancelledMemberId String? // Daha Ã¶nce iptal edilmiÅŸ Ã¼yenin ID'si
  previousCancelledMember   Member?  @relation("PreviousCancelledMember", fields: [previousCancelledMemberId], references: [id])
  reRegisteredMembers       Member[] @relation("PreviousCancelledMember") // Bu Ã¼yeden yeniden kayÄ±t olanlar

  // ðŸ”¹ DokÃ¼man iliÅŸkileri
  documents MemberDocument[]

  // ðŸ”¹ Ãœye gÃ¼ncelleme geÃ§miÅŸi
  history MemberHistory[]

  // ðŸ”¹ Ã–deme iliÅŸkileri
  payments MemberPayment[]

  isActive  Boolean   @default(true)
  deletedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([institutionId])
  @@index([branchId])
  @@index([tevkifatCenterId])
  @@index([tevkifatTitleId])
  @@index([status])
  @@index([professionId])
  @@index([institutionProvinceId])
  @@index([institutionDistrictId])
}

model Province {
  id   String  @id @default(cuid())
  name String
  code String? @unique

  districts                District[]
  members                  Member[]         @relation("MemberProvince")
  memberInstitutionProvinces Member[]        @relation("MemberInstitutionProvince")
  tevkifatCenters          TevkifatCenter[] @relation("ProvinceTevkifatCenters")
  institutions             Institution[]    @relation("ProvinceInstitutions")
  branches                 Branch[]         @relation("ProvinceBranches")

  userScopes   UserScope[]
  customRoles  CustomRole[]
}

model District {
  id         String   @id @default(cuid())
  name       String
  provinceId String
  province   Province @relation(fields: [provinceId], references: [id])

  members                  Member[]         @relation("MemberDistrict")
  memberInstitutionDistricts Member[]        @relation("MemberInstitutionDistrict")
  tevkifatCenters          TevkifatCenter[] @relation("DistrictTevkifatCenters")
  institutions             Institution[]    @relation("DistrictInstitutions")
  branches                 Branch[]         @relation("DistrictBranches")

  userScopes   UserScope[]
  customRoles  CustomRole[]
}

model UserScope {
  id     String @id @default(cuid())
  userId String
  user   User   @relation(fields: [userId], references: [id])

  provinceId String?
  districtId String?

  province Province? @relation(fields: [provinceId], references: [id])
  district District? @relation(fields: [districtId], references: [id])

  createdAt DateTime @default(now())
}

// Custom Role Management
model CustomRole {
  id          String    @id @default(cuid())
  name        String    @unique
  description String?
  isActive    Boolean   @default(true)
  deletedAt   DateTime?

  // ðŸ”¹ Ä°l iliÅŸkisi (MEMBER_LIST_BY_PROVINCE izni iÃ§in)
  provinceId String?
  province   Province? @relation(fields: [provinceId], references: [id])

  // ðŸ”¹ Ä°lÃ§e iliÅŸkisi (MEMBER_LIST_BY_PROVINCE izni iÃ§in ilÃ§e bazlÄ±)
  districtId String?
  district   District? @relation(fields: [districtId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  permissions CustomRolePermission[]
  users       User[]                 @relation("UserCustomRoles")
}

model CustomRolePermission {
  id         String     @id @default(cuid())
  roleId     String
  role       CustomRole @relation(fields: [roleId], references: [id], onDelete: Cascade)
  permission String // Permission enum deÄŸeri

  createdAt DateTime @default(now())

  @@unique([roleId, permission])
  @@index([roleId])
}

// ðŸ”¹ Ä°Ã§erik YÃ¶netimi
enum ContentType {
  NEWS
  ANNOUNCEMENT
  EVENT
}

enum ContentStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

model Content {
  id          String        @id @default(cuid())
  title       String
  content     String        @db.Text
  type        ContentType
  status      ContentStatus @default(DRAFT)
  publishedAt DateTime?

  authorId String
  author   User   @relation("ContentAuthor", fields: [authorId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([authorId])
  @@index([type])
  @@index([status])
}

// ðŸ”¹ DokÃ¼man YÃ¶netimi
enum DocumentTemplateType {
  MEMBER_CERTIFICATE
  MEMBER_CARD
  LETTER
  RESIGNATION_LETTER
  EXPULSION_LETTER
  APPROVAL_CERTIFICATE
  INVITATION_LETTER
  CONGRATULATION_LETTER
  WARNING_LETTER
  NOTIFICATION_LETTER
  MEMBERSHIP_APPLICATION
  TRANSFER_CERTIFICATE
  OTHER
}

model DocumentTemplate {
  id          String               @id @default(cuid())
  name        String
  description String?              @db.Text
  template    String               @db.Text
  type        DocumentTemplateType
  isActive    Boolean              @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  documents MemberDocument[]
}

model MemberDocument {
  id              String            @id @default(cuid())
  memberId        String
  member          Member            @relation(fields: [memberId], references: [id])
  templateId      String?
  template        DocumentTemplate? @relation(fields: [templateId], references: [id])
  documentType    String
  fileName        String
  fileUrl         String
  generatedAt     DateTime          @default(now())
  generatedBy     String
  generatedByUser User?             @relation("DocumentGeneratedBy", fields: [generatedBy], references: [id])

  deletedAt DateTime?

  createdAt DateTime @default(now())

  @@index([memberId])
  @@index([generatedBy])
}

// ðŸ”¹ Bildirimler - GeniÅŸletilmiÅŸ Sistem
enum NotificationType {
  EMAIL
  SMS
  WHATSAPP
  IN_APP
}

enum NotificationCategory {
  SYSTEM // Sistem bildirimleri
  FINANCIAL // Mali bildirimler
  ANNOUNCEMENT // Duyuru bildirimleri
  REMINDER // HatÄ±rlatmalar
}

enum NotificationTypeCategory {
  // Sistem Bildirimleri
  MEMBER_APPLICATION_NEW
  MEMBER_APPLICATION_APPROVED
  MEMBER_APPLICATION_REJECTED
  ROLE_CHANGED
  SCOPE_ASSIGNED
  PASSWORD_RESET
  ACCOUNT_ACTIVATED
  ACCOUNT_DEACTIVATED

  // Mali Bildirimler
  DUES_PAYMENT_RECEIVED
  DUES_OVERDUE
  DUES_BULK_REPORT_READY
  ACCOUNTING_APPROVAL_PENDING

  // Duyuru Bildirimleri
  ANNOUNCEMENT_GENERAL
  ANNOUNCEMENT_REGIONAL
  ANNOUNCEMENT_ELECTION

  // HatÄ±rlatmalar
  REMINDER_DUES_PAYMENT
  REMINDER_DOCUMENT_MISSING
  REMINDER_REPRESENTATIVE_TERM_EXPIRING
  REMINDER_PENDING_APPROVAL
}

enum NotificationTargetType {
  ALL_MEMBERS
  REGION
  SCOPE
  USER // Belirli kullanÄ±cÄ±ya (admin/genel baÅŸkan iÃ§in onay bekleyen iÅŸlemler)
  ROLE // Rol bazlÄ± (Ã¶rn: tÃ¼m il baÅŸkanlarÄ±)
}

enum NotificationStatus {
  PENDING
  SENDING
  SENT
  FAILED
  PARTIALLY_SENT
}

enum NotificationChannel {
  IN_APP
  EMAIL
  SMS
  WHATSAPP
}

model Notification {
  id             String                    @id @default(cuid())
  title          String
  message        String                    @db.Text
  category       NotificationCategory      @default(SYSTEM)
  typeCategory   NotificationTypeCategory?
  type           NotificationType // VeritabanÄ±nda NOT NULL, channels array'inin ilk elemanÄ±ndan tÃ¼retilir
  channels       NotificationChannel[]     @default([IN_APP])
  targetType     NotificationTargetType
  targetId       String? // provinceId, roleId, userId vb.
  targetRole     String? // Rol bazlÄ± bildirim iÃ§in
  status         NotificationStatus        @default(PENDING)
  sentAt         DateTime?
  scheduledFor   DateTime? // ZamanlanmÄ±ÅŸ bildirimler iÃ§in
  sentBy         String
  sentByUser     User?                     @relation("NotificationSentBy", fields: [sentBy], references: [id])
  recipientCount Int                       @default(0)
  successCount   Int                       @default(0)
  failedCount    Int                       @default(0)
  actionUrl      String? // Bildirime tÄ±klandÄ±ÄŸÄ±nda gidilecek URL
  actionLabel    String? // Aksiyon butonu etiketi
  metadata       Json? // Ek bilgiler (entityId, entityType vb.)

  // Ä°liÅŸkiler
  userNotifications UserNotification[]
  recipients        NotificationRecipient[]
  logs              NotificationLog[]

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt

  @@index([sentBy])
  @@index([status])
  @@index([targetType])
  @@index([category])
  @@index([typeCategory])
  @@index([scheduledFor])
}

// ðŸ”¹ Bildirim AlÄ±cÄ±larÄ± (Her alÄ±cÄ± iÃ§in ayrÄ± kayÄ±t)
model NotificationRecipient {
  id             String              @id @default(cuid())
  notificationId String
  notification   Notification        @relation(fields: [notificationId], references: [id], onDelete: Cascade)
  userId         String? // User ID (varsa)
  memberId       String? // Member ID (varsa)
  email          String? // Email adresi
  phone          String? // Telefon numarasÄ±
  channel        NotificationChannel

  // Durum
  status        NotificationStatus @default(PENDING)
  sentAt        DateTime?
  readAt        DateTime?
  deliveredAt   DateTime?
  failedAt      DateTime?
  failureReason String?            @db.Text

  // Ä°liÅŸkiler
  logs NotificationLog[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([notificationId])
  @@index([userId])
  @@index([memberId])
  @@index([status])
  @@index([channel])
}

// ðŸ”¹ KullanÄ±cÄ± Bildirimleri (IN_APP iÃ§in okundu/okunmadÄ± takibi)
model UserNotification {
  id             String       @id @default(cuid())
  userId         String
  user           User         @relation("UserNotifications", fields: [userId], references: [id], onDelete: Cascade)
  notificationId String
  notification   Notification @relation(fields: [notificationId], references: [id], onDelete: Cascade)
  isRead         Boolean      @default(false)
  readAt         DateTime?

  createdAt DateTime @default(now())

  @@unique([userId, notificationId])
  @@index([userId])
  @@index([isRead])
  @@index([notificationId])
  @@index([createdAt])
}

// ðŸ”¹ Bildirim LoglarÄ± (DetaylÄ± audit log)
model NotificationLog {
  id               String                 @id @default(cuid())
  notificationId   String
  notification     Notification           @relation(fields: [notificationId], references: [id], onDelete: Cascade)
  recipientId      String?
  recipient        NotificationRecipient? @relation(fields: [recipientId], references: [id], onDelete: SetNull)
  channel          NotificationChannel
  action           String // SENT, DELIVERED, READ, FAILED, BOUNCED, etc.
  status           NotificationStatus
  message          String?                @db.Text
  metadata         Json? // Ek detaylar
  errorDetails     Json? // Hata detaylarÄ±
  providerResponse Json? // SMS/Email provider yanÄ±tÄ±
  ipAddress        String?
  userAgent        String?

  createdAt DateTime @default(now())

  @@index([notificationId])
  @@index([recipientId])
  @@index([channel])
  @@index([action])
  @@index([status])
  @@index([createdAt])
}

// ðŸ”¹ KullanÄ±cÄ± Bildirim AyarlarÄ±
model UserNotificationSettings {
  id     String @id @default(cuid())
  userId String @unique
  user   User   @relation("UserNotificationSettings", fields: [userId], references: [id], onDelete: Cascade)

  // Kanal ayarlarÄ±
  emailEnabled    Boolean @default(true)
  smsEnabled      Boolean @default(true)
  whatsappEnabled Boolean @default(false)
  inAppEnabled    Boolean @default(true)

  // Saat aralÄ±ÄŸÄ± (zaman dilimi)
  timeZone        String  @default("Europe/Istanbul")
  quietHoursStart String? // HH:mm format (Ã¶rn: "22:00")
  quietHoursEnd   String? // HH:mm format (Ã¶rn: "08:00")

  // Kategori bazlÄ± ayarlar
  systemNotificationsEnabled       Boolean @default(true)
  financialNotificationsEnabled    Boolean @default(true)
  announcementNotificationsEnabled Boolean @default(true)
  reminderNotificationsEnabled     Boolean @default(true)

  // Tip bazlÄ± ayarlar (JSON - NotificationTypeCategory -> boolean mapping)
  typeCategorySettings Json? // { MEMBER_APPLICATION_NEW: true, ... }

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
}

// ðŸ”¹ Sistem AyarlarÄ±
enum SystemSettingCategory {
  GENERAL
  EMAIL
  SMS
  INTEGRATION
  MEMBERSHIP
  DUES
  SECURITY
  NOTIFICATION
  UI
  AUDIT
  OTHER
}

model SystemSetting {
  id               String                @id @default(cuid())
  key              String                @unique
  value            String                @db.Text
  description      String?               @db.Text
  category         SystemSettingCategory
  isEditable       Boolean               @default(true)
  isCritical       Boolean               @default(false) // Kritik ayarlar iÃ§in onay gerekir
  requiresApproval Boolean               @default(false) // Onay mekanizmasÄ± aktif mi?
  updatedAt        DateTime              @updatedAt
  updatedBy        String?
  updatedByUser    User?                 @relation("SystemSettingUpdatedBy", fields: [updatedBy], references: [id])

  createdAt DateTime @default(now())

  @@index([category])
  @@index([key])
  @@index([isCritical])
}

// ðŸ”¹ Sistem LoglarÄ±
model SystemLog {
  id         String  @id @default(cuid())
  action     String
  entityType String
  entityId   String?
  userId     String? // Nullable - baÅŸarÄ±sÄ±z login gibi durumlar iÃ§in
  user       User?   @relation("SystemLogUser", fields: [userId], references: [id])
  details    Json? // Ek detaylar
  ipAddress  String?
  userAgent  String?

  createdAt DateTime @default(now())

  @@index([userId])
  @@index([entityType])
  @@index([action])
  @@index([createdAt])
}

// ðŸ”¹ Åžube YÃ¶netimi
model Branch {
  id                 String  @id @default(cuid())
  name               String
  presidentId        String?
  president          User?   @relation("BranchPresident", fields: [presidentId], references: [id])
  isActive           Boolean @default(true)
  branchSharePercent Decimal @default(40) @db.Decimal(5, 2) // Åžube payÄ± %40
  provinceId         String? // Ä°l'e baÄŸlÄ±ysa
  districtId         String? // Ä°lÃ§e'ye baÄŸlÄ±ysa

  province Province? @relation("ProvinceBranches", fields: [provinceId], references: [id])
  district District? @relation("DistrictBranches", fields: [districtId], references: [id])

  members Member[] @relation("MemberBranch")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([presidentId])
  @@index([provinceId])
  @@index([districtId])
}

// ðŸ”¹ Kurumlar (Institutions)
model Institution {
  id         String    @id @default(cuid())
  name       String
  provinceId String?   // Ä°l'e baÄŸlÄ±ysa
  districtId String?   // Ä°lÃ§e'ye baÄŸlÄ±ysa
  isActive   Boolean   @default(false) // Admin onayÄ± olmadan aktif olmaz
  approvedAt DateTime? // Admin onay tarihi
  approvedBy String?   // Admin kullanÄ±cÄ± ID
  createdBy  String?   // Ä°l/Ä°lÃ§e baÅŸkanÄ± kullanÄ±cÄ± ID

  province Province? @relation("ProvinceInstitutions", fields: [provinceId], references: [id])
  district District? @relation("DistrictInstitutions", fields: [districtId], references: [id])
  members  Member[]

  deletedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([provinceId])
  @@index([districtId])
  @@index([isActive])
}

// ðŸ”¹ Tevkifat Merkezleri
model TevkifatTitle {
  id       String  @id @default(cuid())
  name     String  @unique // Unvan adÄ± (Ã¶rn: "MÃ¼dÃ¼r", "BaÅŸhekim", vb.)
  isActive Boolean @default(true)

  members Member[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model TevkifatCenter {
  id         String  @id @default(cuid())
  name       String  @unique
  isActive   Boolean @default(true)
  provinceId String? // Ä°l'e baÄŸlÄ±ysa
  districtId String? // Ä°lÃ§e'ye baÄŸlÄ±ysa

  province Province? @relation("ProvinceTevkifatCenters", fields: [provinceId], references: [id])
  district District? @relation("DistrictTevkifatCenters", fields: [districtId], references: [id])
  members  Member[]
  files    TevkifatFile[]
  payments MemberPayment[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([provinceId])
  @@index([districtId])
}

// ðŸ”¹ Ãœye GÃ¼ncelleme GeÃ§miÅŸi
model MemberHistory {
  id            String  @id @default(cuid())
  memberId      String
  member        Member  @relation(fields: [memberId], references: [id], onDelete: Cascade)
  action        String // CREATE, UPDATE, DELETE
  fieldName     String? // GÃ¼ncellenen alan adÄ±
  oldValue      String? @db.Text // Eski deÄŸer
  newValue      String? @db.Text // Yeni deÄŸer
  deletedFields Json? // Silinen alanlar (JSON)
  updatedFields Json? // GÃ¼ncellenen alanlar (JSON)
  changedBy     String // Ä°ÅŸlemi yapan kullanÄ±cÄ± ID
  changedByUser User?   @relation("MemberHistoryUser", fields: [changedBy], references: [id])
  ipAddress     String?
  userAgent     String?

  createdAt DateTime @default(now())

  @@index([memberId])
  @@index([changedBy])
  @@index([createdAt])
}

// ðŸ”¹ Onay SÃ¼reÃ§leri (Ä°l/Ä°lÃ§e baÅŸkanlarÄ± iÃ§in)
enum ApprovalStatus {
  PENDING
  APPROVED
  REJECTED
}

enum ApprovalEntityType {
  INSTITUTION
  MEMBER_CREATE
  MEMBER_UPDATE
  MEMBER_DELETE
}

enum PaymentType {
  TEVKIFAT // Kurumdan gelen toplu Ã¶deme
  ELDEN // Elden Ã¶deme
  HAVALE // Havale/EFT Ã¶demesi
}

model Approval {
  id              String             @id @default(cuid())
  entityType      ApprovalEntityType
  entityId        String // Ä°lgili entity ID (Institution, Member vb.)
  status          ApprovalStatus     @default(PENDING)
  requestedBy     String // Ä°stekte bulunan kullanÄ±cÄ± (Ä°l/Ä°lÃ§e baÅŸkanÄ±)
  requestedByUser User?              @relation("ApprovalRequestedBy", fields: [requestedBy], references: [id])
  approvedBy      String? // Onaylayan admin kullanÄ±cÄ±
  approvedByUser  User?              @relation("ApprovalApprovedBy", fields: [approvedBy], references: [id])
  rejectedBy      String? // Reddeden admin kullanÄ±cÄ±
  rejectedByUser  User?              @relation("ApprovalRejectedBy", fields: [rejectedBy], references: [id])
  requestData     Json // Ä°stek verisi (JSON)
  approvalNote    String?            @db.Text
  rejectionNote   String?            @db.Text
  approvedAt      DateTime?
  rejectedAt      DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([entityType])
  @@index([status])
  @@index([requestedBy])
  @@index([createdAt])
}

// ðŸ”¹ Tevkifat DosyalarÄ± (Muhasebe ModÃ¼lÃ¼)
model TevkifatFile {
  id               String         @id @default(cuid())
  tevkifatCenterId String
  tevkifatCenter   TevkifatCenter @relation(fields: [tevkifatCenterId], references: [id])
  totalAmount      Decimal        @db.Decimal(10, 2) // Gelen tutar toplamÄ±
  memberCount      Int // Ãœye sayÄ±sÄ±
  month            Int // Ay (1-12)
  year             Int // YÄ±l
  positionTitle    PositionTitle? // Kadro (seÃ§meli)
  fileName         String
  fileUrl          String
  fileSize         Int? // Dosya boyutu (byte)
  status           ApprovalStatus @default(PENDING) // Admin onay durumu
  uploadedBy       String // YÃ¼kleyen kullanÄ±cÄ± ID
  uploadedByUser   User?          @relation("TevkifatFileUploadedBy", fields: [uploadedBy], references: [id])
  approvedBy       String? // Onaylayan admin kullanÄ±cÄ±
  approvedByUser   User?          @relation("TevkifatFileApprovedBy", fields: [approvedBy], references: [id])
  approvedAt       DateTime?

  // ðŸ”¹ Tevkifat dosyasÄ±na baÄŸlÄ± Ã¶demeler
  payments MemberPayment[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([tevkifatCenterId])
  @@index([year, month])
  @@index([status])
  @@index([uploadedBy])
}

// ðŸ”¹ Ãœye Ã–demeleri
model MemberPayment {
  id                 String          @id @default(cuid())
  memberId           String
  member             Member          @relation(fields: [memberId], references: [id], onDelete: Cascade)
  registrationNumber String? // Ãœye kayÄ±t numarasÄ± (member'dan kopyalanÄ±r, hÄ±zlÄ± eriÅŸim iÃ§in)
  paymentDate        DateTime        @default(now()) // Ã–demenin sisteme iÅŸlendiÄŸi tarih
  paymentPeriodMonth Int // Ay (1-12)
  paymentPeriodYear  Int // YÄ±l
  amount             Decimal         @db.Decimal(10, 2) // Ã–denen tutar
  paymentType        PaymentType // TEVKIFAT / ELDEN / HAVALE
  tevkifatCenterId   String? // Tevkifat merkezi (TEVKIFAT tipinde zorunlu)
  tevkifatCenter     TevkifatCenter? @relation(fields: [tevkifatCenterId], references: [id])
  tevkifatFileId     String? // Tevkifat dosyasÄ± ile iliÅŸki (varsa)
  tevkifatFile       TevkifatFile?   @relation(fields: [tevkifatFileId], references: [id])
  description        String?         @db.Text // Serbest aÃ§Ä±klama
  documentUrl        String? // PDF / dekont URL'i
  isApproved         Boolean         @default(false) // Onay durumu
  approvedByUserId   String? // Onaylayan kullanÄ±cÄ± (Admin/Muhasebe)
  approvedByUser     User?           @relation("MemberPaymentApprovedBy", fields: [approvedByUserId], references: [id])
  approvedAt         DateTime? // Onay zamanÄ±
  createdByUserId    String // Ä°ÅŸlemi yapan kullanÄ±cÄ±
  createdByUser      User            @relation("MemberPaymentCreatedBy", fields: [createdByUserId], references: [id])
  ipAddress          String? // Ä°ÅŸlem IP adresi
  userAgent          String? // User agent (log iÃ§in)

  deletedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([memberId])
  @@index([registrationNumber])
  @@index([paymentPeriodYear, paymentPeriodMonth])
  @@index([paymentType])
  @@index([isApproved])
  @@index([createdByUserId])
  @@index([tevkifatCenterId])
  @@index([tevkifatFileId])
}

// ðŸ”¹ Ãœyelik Bilgisi SeÃ§enekleri (Admin tarafÄ±ndan yÃ¶netilir)
model MembershipInfoOption {
  id          String  @id @default(cuid())
  label       String  @unique // Ã–rn: "Normal Ãœye", "Fahri Ãœye", "Onursal Ãœye"
  value       String // Sistemde kullanÄ±lacak deÄŸer
  description String? @db.Text
  isActive    Boolean @default(true)
  order       Int     @default(0) // SÄ±ralama

  members Member[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([isActive])
  @@index([order])
}

// ðŸ”¹ Meslek/Unvan (Profession)
model Profession {
  id       String  @id @default(cuid())
  name     String  @unique // Meslek/Unvan adÄ±
  isActive Boolean @default(true)

  members Member[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([isActive])
}
